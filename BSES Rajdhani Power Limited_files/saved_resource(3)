YUI.add("aui-rating-base",function(e,t){var n=e.Lang,r=n.isBoolean,i=n.isNumber,s=n.isString,o=13,u=e.getClassName,a=u("glyphicon"),f=u("glyphicon","star"),l=u("glyphicon","star","empty"),c=u("rating","label"),h='<a class="{cssClasses}" tabindex="{tabindex}"></a>',p='<span class="'+c+'"></span>',d=e.Component.create({NAME:"rating",ATTRS:{disabled:{value:!1,validator:r},canReset:{value:!0,validator:r},cssClasses:{value:{element:[a,l].join(" "),hover:[a,f].join(" "),off:[a,l].join(" "),on:[a,f].join(" ")}},defaultSelected:{value:0,writeOnce:!0,validator:i},elements:{validator:e.Lang.isNodeList},hiddenInput:{validator:e.Lang.isNode},inputName:{value:"",validator:s},label:{value:"",validator:s},labelNode:{valueFn:function(){return e.Node.create(p)},validator:e.Lang.isNode},selectedIndex:{value:-1,validator:i},showTitle:{value:!0,validator:r},size:{value:5,validator:function(e){return i(e)&&e>0}},title:null,value:null},HTML_PARSER:{elements:function(e){return e.all("a")},label:function(e){var t=e.one("."+c);if(t)return t.html()},labelNode:"."+c},prototype:{BOUNDING_TEMPLATE:"<span></span>",CONTENT_TEMPLATE:"<span></span>",initializer:function(){var e=this;e.inputElementsData={},e.after("labelChange",this._afterSetLabel)},renderUI:function(){var e=this;e._parseInputElements(),e._renderLabel(),e._renderElements()},bindUI:function(){var e=this;e._createEvents(),e.on({click:e._handleClickEvent,keypress:e._handleKeyPressEvent,mouseover:e._handleMouseOverEvent,mouseout:e._handleMouseOutEvent})},syncUI:function(){var e=this;e._syncElements(),e._syncLabelUI()},clearSelection:function(){var e=this,t=e.get("cssClasses");e.get("elements").each(function(e){e.removeClass(t.on),e.removeClass(t.hover),e.addClass(t.element)})},select:function(e){var t=this,n=t.get("selectedIndex"),r=t.get("canReset");r&&n===e&&(e=-1),t.set("selectedIndex",e);var i=t.get("selectedIndex"),s=t._getInputData(i),o="title"in s?s.title:"",u="value"in s?s.value:i;t.fillTo(i),t.set("title",o),t.set("value",u);var a=t.get("hiddenInput");a.setAttribute("title",o),a.setAttribute("value",u)},fillTo:function(e,t){var n=this,r=n.get("cssClasses");n.clearSelection(),e>=0&&n.get("elements").some(function(n,i){return n.addClass(t||r.on),n.removeClass(r.element),i===Math.round(e)})},indexOf:function(e){var t=this;return t.get("elements").indexOf(e)},_canFireCustomEvent:function(e){var t=this,n=e.domEvent.target;return!t.get("disabled")&&n.test("a")},_createElements:function(){var t=this,r=t.get("cssClasses"),i,s=[],o=this.get("size");i=t.get("disabled");for(var u=0;u<o;u++)s.push(n.sub(h,{cssClasses:r.element,tabindex:i?-1:0}));return e.NodeList.create(s.join(""))},_createEvents:function(){var e=this,t=function(t,n){e.publish(t,{defaultFn:n,queuable:!1,emitFacade:!0,bubbles:!0})};t("itemClick",this._defRatingItemClickFn),t("itemSelect",this._defRatingItemSelectFn),t("itemOver",this._defRatingItemOverFn),t("itemOut",this._defRatingItemOutFn)},_defRatingItemClickFn:function(e){var t=this,n=e.domEvent;t.fire("itemSelect",{delegateEvent:e,domEvent:n,ratingItem:n.target})},_defRatingItemSelectFn:function(e){var t=this,n=e.domEvent.target;t.select(t.indexOf(n))},_defRatingItemOutFn:function(){var e=this;e.fillTo(e.get("selectedIndex"))},_defRatingItemOverFn:function(e){var t=this,n=t.get("cssClasses"),r=t.indexOf(e.domEvent.target);t.fillTo(r,n.hover)},_handleKeyPressEvent:function(e){var t=this,n;n=e.domEvent,n.charCode===o&&t._handleClickEvent(e)},_parseInputElements:function(){var t=this,n=t.get("boundingBox"),r=n.all("input"),i=r.size(),s=t.get("inputName"),o=e.Node.create('<input type="hidden" />');if(i>0){s=s||r.item(0).getAttribute("name"),t.set("size",i);var u=n.getElementsByTagName("label");r.each(function(e,n){var r=e.get("id"),i="";if(r){var s=u.filter('[for="'+r+'"]');s.size()&&(i=s.item(0).html())}t.inputElementsData[n]={content:i,value:e.getAttribute("value")||n,title:e.getAttribute("title")}}),u.remove(!0),r.remove(!0)}s&&(o.setAttribute("name",s),n.appendChild(o)),t.set("hiddenInput",o)},_renderLabel:function(){var e=this;e.get("contentBox").setContent(e.get("labelNode"))},_renderElements:function(){var e=this,t=e.get("contentBox"),n=e.get("elements");if(!n||!n.size())n=e._createElements(),e.set("elements",n);n.each(function(t,n){var r=e._getInputData(n),i=r.content,s=r.title||e.get("title")||i;s&&e.get("showTitle")&&t.setAttribute("title",s),!t.attr("href")&&t.get("nodeName").toLowerCase()==="a"&&t.setAttribute("onclick","return false;")}),t.append(n.getDOM())},_syncElements:function(){var e=this,t=e.get("defaultSelected")-1;e.set("selectedIndex",t),e.select()},_syncLabelUI:function(){var e=this,t=e.get("label");e.get("labelNode").html(t)},_getInputData:function(e){var t=this;return t.inputElementsData[e]||{}},_handleClickEvent:function(e){var t=this,n=e.domEvent;t._canFireCustomEvent(e)?t.fire("itemClick",{delegateEvent:e,domEvent:n}):n.preventDefault()},_handleMouseOutEvent:function(e){var t=this;t._canFireCustomEvent(e)&&t.fire("itemOut",{delegateEvent:e,domEvent:e.domEvent})},_handleMouseOverEvent:function(e){var t=this;t._canFireCustomEvent(e)&&t.fire("itemOver",{delegateEvent:e,domEvent:e.domEvent})},_afterSetLabel:function(){this._syncLabelUI()}}});e.Rating=d,e.StarRating=d},"3.0.3-deprecated.100",{requires:["aui-component","aui-node-base","widget-htmlparser","widget-uievents"],skinnable:!0});

YUI.add("aui-rating-thumb",function(e,t){var n=e.getClassName,r=n("glyphicon"),i=n("glyphicon","thumbs","down"),s=n("glyphicon","thumbs","up"),o=n("rating","off"),u=n("rating","on"),a=e.Component.create({NAME:"ThumbRating",ATTRS:{cssClasses:{value:{down:[r,i].join(" "),element:o,hover:u,off:o,on:u,up:[r,s].join(" ")}},size:{value:2,readOnly:!0}},EXTENDS:e.Rating,prototype:{renderUI:function(){var e=this,t=e.get("cssClasses");a.superclass.renderUI.apply(this,arguments);var n=e.get("elements");n.addClass(t.off),n.item(0).addClass(t.up),n.item(1).addClass(t.down)},fillTo:function(e){var t=this,n=t.get("cssClasses");this.clearSelection();if(e>=0){var r=this.get("elements").item(e);r.addClass(n.on),r.removeClass(n.off)}},_syncElements:function(){}}});e.ThumbRating=a},"3.0.3-deprecated.100",{requires:["aui-rating-base"]});

AUI.add("liferay-ratings",function(f){var l=f.Lang,m=l.emptyFn,s=["focus","mousemove","touchstart"],n=[],h=f.Component.create({ATTRS:{averageScore:{},className:{},classPK:{},namespace:{},round:{},size:{},totalEntries:{},totalScore:{},type:{},uri:{},yourScore:{getter:function(a){"stars"==this.get("type")&&-1==a&&(a=0);return a}}},EXTENDS:f.Base,prototype:{initializer:function(){this._renderRatings()},_bindRatings:function(){this.ratings.after("itemSelect",this._itemSelect,this)},_convertToIndex:function(a){var b=
-1;1==a?b=0:0==a&&(b=1);return b},_fixScore:function(a){var b="";0<a&&(b="+");return b+a},_getLabel:function(a,b){var c="",c=1==b?'Vote':'Votes';return l.sub("{desc} ({totalEntries} {voteLabel})",{desc:a,totalEntries:b,voteLabel:c})},_itemSelect:m,_renderRatings:m,_sendVoteRequest:function(a,b,c){f.io.request(a,{data:{className:this.get("className"),classPK:this.get("classPK"),p_auth:Liferay.authToken,p_l_id:themeDisplay.getPlid(),score:b},dataType:"JSON",
on:{success:f.bind(c,this)}})},_showScoreTooltip:function(a){var b="",c=this._ratingScoreNode.all(".icon-star").size(),b=1==c?'Star':'Stars';Liferay.Portal.ToolTip.show(a.currentTarget,c+" "+b)},_updateAverageScoreText:function(a){var b=this._ratingScoreNode.one(".rating-element");if(b){var c="",c=1==a?'The\x20average\x20rating\x20is\x20\x7b0\x7d\x20star\x20out\x20of\x20\x7b1\x7d\x2e':'The\x20average\x20rating\x20is\x20\x7b0\x7d\x20stars\x20out\x20of\x20\x7b1\x7d\x2e';a=l.sub(c,[a,this.get("size")]);
b.attr("title",a)}},_updateScoreText:function(a){var b=this;b._ratingStarNode.all(".rating-element").each(function(c,d){var e="",g="";a===d+1?(e=0===d?'You\x20have\x20rated\x20this\x20\x7b0\x7d\x20star\x20out\x20of\x20\x7b1\x7d\x2e':'You\x20have\x20rated\x20this\x20\x7b0\x7d\x20stars\x20out\x20of\x20\x7b1\x7d\x2e',g=a):(e=0===d?'Rate\x20this\x20\x7b0\x7d\x20star\x20out\x20of\x20\x7b1\x7d\x2e':'Rate\x20this\x20\x7b0\x7d\x20stars\x20out\x20of\x20\x7b1\x7d\x2e',g=d+1);c.attr("title",l.sub(e,[g,b.get("size")]))})}},register:function(a){var b=a.containerId&&document.getElementById(a.containerId);
b?(n.push({config:a,container:f.one(b)}),this._registerTask()):this._registerRating(a)},_registerRating:function(a){var b=null;"like"===a.type?b=Liferay.Ratings.LikeRating:"stars"===a.type?b=Liferay.Ratings.StarRating:"thumbs"===a.type&&(b=Liferay.Ratings.ThumbRating);var c=null;b&&document.getElementById(a.containerId)&&(c=new b(a),this._INSTANCES[a.id||a.namespace]=c);return c},_registerTask:f.debounce(function(){n.forEach(function(a,b){var c=a.container.on(s,function(d){c.detach();var e=a.config;
e.initialFocus="focus"===d.type;h._registerRating(e)})});n.length=0},100),_INSTANCES:{},_thumbScoreMap:{"-1":-1,down:0,up:1}}),m=f.Component.create({ATTRS:{initialFocus:{validator:l.isBoolean}},EXTENDS:h,prototype:{_itemSelect:function(a){a=(this.ratings.get("selectedIndex")+1)/this.get("size");var b=this.get("uri");this._sendVoteRequest(b,a,this._saveCallback)},_renderRatings:function(){var a=this.get("namespace");this._ratingScoreNode=f.one("#"+a+"ratingScoreContent");this._ratingStarNode=f.one("#"+
a+"ratingStarContent");if(themeDisplay.isSignedIn()){var b=this.get("yourScore")*this.get("size");this.ratings=(new f.StarRating({boundingBox:"#"+a+"ratingStar",canReset:!1,cssClasses:{element:"icon-star-empty",hover:"icon-star",off:"icon-star-empty",on:"icon-star"},defaultSelected:b,srcNode:"#"+a+"ratingStarContent"})).render();this.get("initialFocus")&&this.ratings.get("elements").item(0).focus();this._bindRatings()}this._ratingScoreNode.on("mouseenter",this._showScoreTooltip,this)},_saveCallback:function(a,
b,c){c=a.currentTarget.get("responseData");var d='Average';b=c.averageScore*this.get("size");a=c.score*this.get("size");c=this._getLabel(d,c.totalEntries);b=b.toFixed(1);var e=this.get("round")?Math.round(b):Math.floor(b),d=this._ratingScoreNode;d.one(".rating-label").html(c);d.all(".rating-element").each(function(g,k){var p="icon-star",q="icon-star-empty";k<e&&(p="icon-star-empty",q="icon-star");g.replaceClass(p,q)});this._updateAverageScoreText(b);this._updateScoreText(a)}}}),
r=f.Component.create({ATTRS:{initialFocus:{validator:l.isBoolean}},EXTENDS:h,prototype:{_createRating:function(){var a=this.get("namespace");this.ratings=(new f.ThumbRating({boundingBox:"#"+a+"ratingThumb",srcNode:"#"+a+"ratingThumbContent"})).render()},_getThumbScores:function(a,b){var c=Math.floor(b);return{negativeVotes:a-c,positiveVotes:c}},_itemSelect:function(a){a=this.get("uri");var b=this.ratings.get("value");this._sendVoteRequest(a,Liferay.Ratings._thumbScoreMap[b],this._saveCallback)},_renderRatings:function(){if(themeDisplay.isSignedIn()){var a=
this.get("yourScore"),a=this._convertToIndex(a),b=this.get("namespace");this._createRating();this.get("initialFocus")&&f.one("#"+b+"ratingThumb a").focus();this._bindRatings();this.ratings.select(a)}},_saveCallback:function(a,b,c){a=a.currentTarget.get("responseData");a=this._getThumbScores(a.totalEntries,a.totalScore);this._updateScores(a)},_updateScores:function(a){var b=this.ratings,c=b.get("cssClasses"),d=b.get("elements"),e=d.item(1),d=d.item(0);if(isNaN(a.negativeVotes)&&isNaN(a.positiveVotes))e.attr("title",
'You\x20must\x20be\x20signed\x20in\x20to\x20rate\x2e'),d.attr("title",'You\x20must\x20be\x20signed\x20in\x20to\x20rate\x2e'),e.addClass(c.off),d.addClass(c.off),e.removeClass(c.on),d.removeClass(c.on),b.set("disabled",!0);else{var g=c.on,b=!1;e&&(b=e.hasClass(g));c=!1;d&&(c=d.hasClass(g));var k=g="";e&&(g=b?'You\x20have\x20rated\x20this\x20as\x20bad\x2e':'Rate\x20this\x20as\x20bad\x2e',e.attr("title",g),e.html(a.negativeVotes));e&&c?k='You\x20have\x20rated\x20this\x20as\x20good\x2e':
e&&!c?k='Rate\x20this\x20as\x20good\x2e':!e&&c?k='Unlike\x20This':e||c||(k='Like\x20This');d&&(d.attr("title",k),d.html(a.positiveVotes))}}}}),t=f.Component.create({EXTENDS:f.ThumbRating,NAME:"LikeRatingImpl",prototype:{renderUI:function(){var a=this.get("cssClasses");f.ThumbRating.superclass.renderUI.apply(this,arguments);var b=this.get("elements");b.addClass(a.off);b.item(0).addClass(a.up)}}}),u=f.Component.create({EXTENDS:r,NAME:"LikeRating",prototype:{_createRating:function(){var a=
this.get("namespace");this.ratings=(new t({boundingBox:"#"+a+"ratingLike",srcNode:"#"+a+"ratingLikeContent"})).render()},_getThumbScores:function(a,b){return{positiveVotes:a}}}});h.LikeRating=u;h.StarRating=m;h.ThumbRating=r;Liferay.Ratings=h},"",{requires:["aui-io-request","aui-rating"]});
